{"version":3,"names":[],"mappings":"","sources":["admin/edit-booking.js"],"sourcesContent":["(function($, plugin) {\n  'use strict';\n\n  const localize = window._awebookingEditBooking || {};\n  const i18n     = localize.i18n || {};\n\n  /**\n   * Handle the xhr fail.\n   *\n   * @param  {jqXHR} xhr\n   * @return {void}\n   */\n  const handleXhrFail = function(xhr) {\n    xhr.fail(function(xhr) {\n      const res = xhr.responseJSON || $.parseJSON(xhr.responseText);\n\n      if (res.message) {\n        plugin.alert(res.message, res.status);\n      }\n\n      if (plugin.debug) {\n        console.log(xhr);\n      }\n    });\n  };\n\n  class EditBooking {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      $('.js-editnow').click(this.handleEditAddress);\n\n      $('#js-add-note').click(this.handleAddNote);\n      $(document).on( 'click', '.js-delete-note', this.handleDeleteNote);\n    }\n\n    /**\n     * Handle toggle edit address.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleEditAddress(e) {\n      e.preventDefault();\n\n      const focus = $(this).data('focus');\n      const $wrapper = $(this).closest('.js-booking-column');\n\n      $wrapper.find('h3 > a.button-editnow').hide();\n      $wrapper.find('div.js-booking-data').hide();\n      $wrapper.find('div.js-edit-booking-data').show();\n\n      if (focus && $(focus, $wrapper).length) {\n        $(focus, $wrapper).focus();\n      }\n    }\n\n    /**\n     * Handle click add note button.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleAddNote(e) {\n      e.preventDefault();\n\n      const $notes = $('#js-booking-notes');\n      const $noteInput = $('#js-booking-note');\n\n      let content = (new String($noteInput.val())).trim();\n      if (content.length === 0) {\n        plugin.alert(i18n.empty_note_warning, 'warning');\n        return;\n      }\n\n      let noteType = '';\n      if ($('#js-customer-note').prop('checked') === true) {\n        noteType = 'customer';\n      }\n\n      const xhr = $.ajax({\n        type: 'POST',\n        url:  plugin.route('/ajax/booking-note'),\n        data: {\n          note:        content,\n          note_type:   noteType,\n          booking:     parseInt($('#post_ID').val(), 10),\n          _ajax_nonce: localize.add_note_nonce,\n        }\n      });\n\n      xhr.done(function(res) {\n        $noteInput.val('');\n        $(res.data).prependTo($notes);\n\n        if ($notes.find('.awebooking-no-items').length) {\n          $notes.find('.awebooking-no-items').closest('li').remove();\n        }\n      });\n\n      handleXhrFail(xhr);\n    }\n\n    /**\n     * Handle delete note.\n     *\n     * @param  {Event} e\n     * @return {void}\n     */\n    handleDeleteNote(e) {\n      e.preventDefault();\n\n      const $el = $(this).closest('.booking-note');\n      if (! $el.length || !$el.attr('rel')) {\n        return;\n      }\n\n      plugin.confirm(i18n.delete_note_warning, function() {\n        const noteID = parseInt($el.attr('rel'), 10);\n\n        const xhr = $.ajax({\n          type: 'POST',\n          url:   plugin.route('/ajax/booking-note/' + noteID),\n          data: { _method: 'DELETE', _ajax_nonce: localize.delete_note_nonce }\n        });\n\n        xhr.done(function() {\n          $el.slideUp(100, function() { $el.remove() });\n        });\n\n        handleXhrFail(xhr);\n      });\n    }\n  }\n\n  // Document ready!\n  $(function() {\n    plugin.instances.editBooking = new EditBooking;\n  });\n\n})(jQuery, window.awebooking || {});\n"],"file":"edit-booking.js"}