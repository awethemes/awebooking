{"version":3,"names":[],"mappings":"","sources":["admin/edit-booking.js"],"sourcesContent":["(function($, plugin) {\r\n  'use strict';\r\n\r\n  const localize = window._awebookingEditBooking || {};\r\n  const i18n     = localize.i18n || {};\r\n\r\n  /**\r\n   * Handle the xhr fail.\r\n   *\r\n   * @param  {jqXHR} xhr\r\n   * @return {void}\r\n   */\r\n  const handleXhrFail = function(xhr) {\r\n    xhr.fail(function(xhr) {\r\n      const res = xhr.responseJSON || $.parseJSON(xhr.responseText);\r\n\r\n      if (res.message) {\r\n        plugin.alert(res.message, res.status);\r\n      }\r\n\r\n      if (plugin.debug) {\r\n        console.log(xhr);\r\n      }\r\n    });\r\n  };\r\n\r\n  class EditBooking {\r\n    /**\r\n     * Constructor.\r\n     *\r\n     * @return {void}\r\n     */\r\n    constructor() {\r\n      $('.js-editnow').click(this.handleEditAddress);\r\n\r\n      $('#js-add-note').click(this.handleAddNote);\r\n      $(document).on( 'click', '.js-delete-note', this.handleDeleteNote);\r\n    }\r\n\r\n    /**\r\n     * Handle toggle edit address.\r\n     *\r\n     * @param  {Event} e\r\n     * @return {void}\r\n     */\r\n    handleEditAddress(e) {\r\n      e.preventDefault();\r\n\r\n      const focus = $(this).data('focus');\r\n      const $wrapper = $(this).closest('.js-booking-column');\r\n\r\n      $wrapper.find('h3 > a.button-editnow').hide();\r\n      $wrapper.find('div.js-booking-data').hide();\r\n      $wrapper.find('div.js-edit-booking-data').show();\r\n\r\n      if (focus && $(focus, $wrapper).length) {\r\n        $(focus, $wrapper).focus();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Handle click add note button.\r\n     *\r\n     * @param  {Event} e\r\n     * @return {void}\r\n     */\r\n    handleAddNote(e) {\r\n      e.preventDefault();\r\n\r\n      const $notes = $('#js-booking-notes');\r\n      const $noteInput = $('#js-booking-note');\r\n\r\n      let content = (new String($noteInput.val())).trim();\r\n      if (content.length === 0) {\r\n        plugin.alert(i18n.empty_note_warning, 'warning');\r\n        return;\r\n      }\r\n\r\n      let noteType = '';\r\n      if ($('#js-customer-note').prop('checked') === true) {\r\n        noteType = 'customer';\r\n      }\r\n\r\n      const xhr = $.ajax({\r\n        type: 'POST',\r\n        url:  plugin.route('/ajax/booking-note'),\r\n        data: {\r\n          note:        content,\r\n          note_type:   noteType,\r\n          booking:     parseInt($('#post_ID').val(), 10),\r\n          _ajax_nonce: localize.add_note_nonce,\r\n        }\r\n      });\r\n\r\n      xhr.done(function(res) {\r\n        $noteInput.val('');\r\n        $(res.data).prependTo($notes);\r\n\r\n        if ($notes.find('.awebooking-no-items').length) {\r\n          $notes.find('.awebooking-no-items').closest('li').remove();\r\n        }\r\n      });\r\n\r\n      handleXhrFail(xhr);\r\n    }\r\n\r\n    /**\r\n     * Handle delete note.\r\n     *\r\n     * @param  {Event} e\r\n     * @return {void}\r\n     */\r\n    handleDeleteNote(e) {\r\n      e.preventDefault();\r\n\r\n      const $el = $(this).closest('.booking-note');\r\n      if (! $el.length || !$el.attr('rel')) {\r\n        return;\r\n      }\r\n\r\n      plugin.confirm(i18n.delete_note_warning, function() {\r\n        const noteID = parseInt($el.attr('rel'), 10);\r\n\r\n        const xhr = $.ajax({\r\n          type: 'POST',\r\n          url:   plugin.route('/ajax/booking-note/' + noteID),\r\n          data: { _method: 'DELETE', _ajax_nonce: localize.delete_note_nonce }\r\n        });\r\n\r\n        xhr.done(function() {\r\n          $el.slideUp(100, function() { $el.remove() });\r\n        });\r\n\r\n        handleXhrFail(xhr);\r\n      });\r\n    }\r\n  }\r\n\r\n  // Document ready!\r\n  $(function() {\r\n    plugin.instances.editBooking = new EditBooking;\r\n  });\r\n\r\n})(jQuery, window.awebooking || {});\r\n"],"file":"edit-booking.js"}