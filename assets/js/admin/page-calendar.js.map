{"version":3,"names":[],"mappings":"","sources":["admin/page-calendar.js"],"sourcesContent":["(function($, plugin) {\n  'use strict';\n\n  const DATE_FORMAT  = 'YYYY-MM-DD';\n\n  class BookingScheduler {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      const self = this;\n\n      this.initBulkUpdate();\n\n      this.scheduler = new ScheduleCalendar({\n        el: '.scheduler',\n        debug: plugin.debug,\n        granularity: 'nightly',\n      });\n\n      this.scheduler.on('clear', this.handleClearSelected.bind(this));\n      this.scheduler.on('action:block', this.handleBlockRoom.bind(this));\n      this.scheduler.on('action:unblock', this.handleUnblockRoom.bind(this));\n\n      $('.js-unlock-period').on('click', function(e) {\n        e.preventDefault();\n        const $el = $(this);\n\n        self.scheduler.model.set('calendar', $el.data('room'));\n        self.scheduler.model.set('startDate', moment($el.data('startDate')));\n        self.scheduler.model.set('endDate', moment($el.data('endDate')));\n\n        self.scheduler.trigger('action:unblock');\n      });\n\n      $('.scheduler__state-event, .scheduler__booking-event').each(function() {\n        self.setupEventPopper(this);\n      });\n    }\n\n    /**\n     * Handle on clear selected.\n     *\n     * @return {void}\n     */\n    handleClearSelected() {\n      window.swal && swal.close();\n    }\n\n    /**\n     * Handle set price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleBlockRoom(e, model) {\n      plugin.confirm(plugin.i18n.warning, () => {\n        const $controls = this.compileHtmlControls('block', model);\n        $controls.closest('form').submit();\n      });\n    }\n\n    /**\n     * Handle reset price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleUnblockRoom(e, model) {\n      plugin.confirm(plugin.i18n.warning, () => {\n        const $controls = this.compileHtmlControls('unblock', model);\n        $controls.closest('form').submit();\n      });\n    }\n\n    /**\n     * Compile html form controls.\n     *\n     * @param  {string} action\n     * @return {void}\n     */\n    compileHtmlControls(action, model) {\n      const template = wp.template('scheduler-pricing-controls');\n\n      if (! model) {\n        model = this.scheduler.model;\n      }\n\n      const data = {\n        action:    action,\n        endDate:   model.get('endDate').format(DATE_FORMAT),\n        startDate: model.get('startDate').format(DATE_FORMAT),\n        calendar:  model.get('calendar'),\n      };\n\n      return $('#js-scheduler-form-controls').html(template(data));\n    }\n\n    /**\n     * Setup event popper.\n     *\n     * @param  {Object} el\n     * @return {void}\n     */\n    setupEventPopper(el) {\n      const $html = $(el).find('.js-tippy-html');\n\n      tippy(el, {\n        theme: 'booking-popup',\n        delay: 150,\n        arrow: true,\n        distance: 0,\n        maxWidth: '500px',\n        placement: 'bottom',\n        trigger: 'mouseenter focus',\n        interactive: true,\n        performance: true,\n        hideOnClick: false,\n        animation: 'shift-toward',\n        duration: [150, 150],\n        html: $html.length ? $html[0] : false,\n        popperOptions: { modifiers: {\n          hide: { enabled: false },\n          preventOverflow: { enabled: false },\n        }}\n      });\n\n      return el._tippy;\n    }\n\n    /**\n     * Handle bulk update action.\n     */\n    initBulkUpdate() {\n      const $dialog = plugin.dialog('#bulk-update-dialog');\n\n      $('.js-open-bulk-update').on('click', function(e) {\n        e.preventDefault();\n        $dialog.dialog('open');\n      });\n\n      flatpickr('#bulk_date_start', {\n        dateFormat: 'Y-m-d',\n        plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\n      });\n    }\n  }\n\n  /**\n   * Document ready!\n   *\n   * @return {void}\n   */\n  $(function() {\n    (new BookingScheduler);\n  });\n\n})(jQuery, window.awebooking);\n"],"file":"page-calendar.js"}