{"version":3,"names":[],"mappings":"","sources":["admin/page-calendar.js"],"sourcesContent":["(function($, plugin) {\r\n  'use strict';\r\n\r\n  const DATE_FORMAT  = 'YYYY-MM-DD';\r\n\r\n  class BookingScheduler {\r\n    /**\r\n     * Constructor.\r\n     *\r\n     * @return {void}\r\n     */\r\n    constructor() {\r\n      const self = this;\r\n\r\n      this.initBulkUpdate();\r\n\r\n      this.scheduler = new ScheduleCalendar({\r\n        el: '.scheduler',\r\n        debug: plugin.debug,\r\n        granularity: 'nightly',\r\n      });\r\n\r\n      this.scheduler.on('clear', this.handleClearSelected.bind(this));\r\n      this.scheduler.on('action:block', this.handleBlockRoom.bind(this));\r\n      this.scheduler.on('action:unblock', this.handleUnblockRoom.bind(this));\r\n\r\n      $('.js-unlock-period').on('click', function(e) {\r\n        e.preventDefault();\r\n        const $el = $(this);\r\n\r\n        self.scheduler.model.set('calendar', $el.data('room'));\r\n        self.scheduler.model.set('startDate', moment($el.data('startDate')));\r\n        self.scheduler.model.set('endDate', moment($el.data('endDate')));\r\n\r\n        self.scheduler.trigger('action:unblock');\r\n      });\r\n\r\n      $('.scheduler__state-event, .scheduler__booking-event').each(function() {\r\n        self.setupEventPopper(this);\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Handle on clear selected.\r\n     *\r\n     * @return {void}\r\n     */\r\n    handleClearSelected() {\r\n      window.swal && swal.close();\r\n    }\r\n\r\n    /**\r\n     * Handle set price action.\r\n     *\r\n     * @param  {Event}  e\r\n     * @param  {Object} model\r\n     * @return {void}\r\n     */\r\n    handleBlockRoom(e, model) {\r\n      plugin.confirm(plugin.i18n.warning, () => {\r\n        const $controls = this.compileHtmlControls('block', model);\r\n        $controls.closest('form').submit();\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Handle reset price action.\r\n     *\r\n     * @param  {Event}  e\r\n     * @param  {Object} model\r\n     * @return {void}\r\n     */\r\n    handleUnblockRoom(e, model) {\r\n      plugin.confirm(plugin.i18n.warning, () => {\r\n        const $controls = this.compileHtmlControls('unblock', model);\r\n        $controls.closest('form').submit();\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Compile html form controls.\r\n     *\r\n     * @param  {string} action\r\n     * @return {void}\r\n     */\r\n    compileHtmlControls(action, model) {\r\n      const template = wp.template('scheduler-pricing-controls');\r\n\r\n      if (! model) {\r\n        model = this.scheduler.model;\r\n      }\r\n\r\n      const data = {\r\n        action:    action,\r\n        endDate:   model.get('endDate').format(DATE_FORMAT),\r\n        startDate: model.get('startDate').format(DATE_FORMAT),\r\n        calendar:  model.get('calendar'),\r\n      };\r\n\r\n      return $('#js-scheduler-form-controls').html(template(data));\r\n    }\r\n\r\n    /**\r\n     * Setup event popper.\r\n     *\r\n     * @param  {Object} el\r\n     * @return {void}\r\n     */\r\n    setupEventPopper(el) {\r\n      const $html = $(el).find('.js-tippy-html');\r\n\r\n      tippy(el, {\r\n        theme: 'booking-popup',\r\n        delay: 150,\r\n        arrow: true,\r\n        distance: 0,\r\n        maxWidth: '500px',\r\n        placement: 'bottom',\r\n        trigger: 'mouseenter focus',\r\n        interactive: true,\r\n        performance: true,\r\n        hideOnClick: false,\r\n        animation: 'shift-toward',\r\n        duration: [150, 150],\r\n        html: $html.length ? $html[0] : false,\r\n        popperOptions: { modifiers: {\r\n          hide: { enabled: false },\r\n          preventOverflow: { enabled: false },\r\n        }}\r\n      });\r\n\r\n      return el._tippy;\r\n    }\r\n\r\n    /**\r\n     * Handle bulk update action.\r\n     */\r\n    initBulkUpdate() {\r\n      const $dialog = plugin.dialog('#bulk-update-dialog');\r\n\r\n      $('.js-open-bulk-update').on('click', function(e) {\r\n        e.preventDefault();\r\n        $dialog.dialog('open');\r\n      });\r\n\r\n      flatpickr('#bulk_date_start', {\r\n        mode: 'range',\r\n        dateFormat: 'Y-m-d',\r\n        showMonths: 2,\r\n        plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Document ready!\r\n   *\r\n   * @return {void}\r\n   */\r\n  $(function() {\r\n    new BookingScheduler();\r\n  });\r\n\r\n})(jQuery, window.awebooking);\r\n"],"file":"page-calendar.js"}