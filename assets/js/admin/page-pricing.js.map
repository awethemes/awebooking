{"version":3,"sources":["admin/page-pricing.js"],"names":["$","plugin","window","awebooking","DATE_FORMAT","PricingScheduler","flatpickr","scheduler","ScheduleCalendar","el","debug","granularity","$dialog","dialog","modal","width","height","autoOpen","draggable","resizable","closeOnEscape","dialogClass","position","my","at","of","on","handleClearSelected","bind","handleSetPrice","handleResetPrice","swal","close","destroy","html","e","model","compileHtmlControls","confirm","i18n","warning","$form","closest","submit","action","amount","template","wp","roomtype","_listRoomTypes","_","findWhere","id","get","calendar","endDate","format","startDate","dateFormat","plugins","rangePlugin","input","jQuery"],"mappings":"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","sourcesContent":["(function($) {\n  'use strict';\n\n  const plugin = window.awebooking || {};\n  const DATE_FORMAT  = 'YYYY-MM-DD';\n\n  class PricingScheduler {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      this.flatpickr = null;\n\n      this.scheduler = new ScheduleCalendar({\n        el: '.scheduler',\n        debug: plugin.debug,\n        granularity: 'daily',\n      });\n\n      this.$dialog = $('#scheduler-form-dialog').dialog({\n        modal: true,\n        width: 'auto',\n        height: 'auto',\n        autoOpen: false,\n        draggable: false,\n        resizable: false,\n        closeOnEscape: true,\n        dialogClass: 'wp-dialog awebooking-dialog',\n        position: { my: 'center', at: 'center center-15%', of: window },\n      });\n\n      this.scheduler.on('clear', this.handleClearSelected.bind(this));\n      this.scheduler.on('action:set-price', this.handleSetPrice.bind(this));\n      this.scheduler.on('action:reset-price', this.handleResetPrice.bind(this));\n    }\n\n    /**\n     * Handle on clear selected.\n     *\n     * @return {void}\n     */\n    handleClearSelected() {\n      window.swal && swal.close();\n\n      if (this.flatpickr) {\n        this.flatpickr.destroy();\n      }\n\n      this.$dialog.dialog('close');\n      $('#js-scheduler-form-controls').html('');\n    }\n\n    /**\n     * Handle set price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleSetPrice(e, model) {\n      window.swal && swal.close();\n\n      this.compileHtmlControls('set_price', 0);\n\n      this.$dialog.dialog('open');\n    }\n\n    /**\n     * Handle reset price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleResetPrice(e, model) {\n      plugin.confirm(plugin.i18n.warning, () => {\n        const $form = this.compileHtmlControls('reset_price', 0);\n        $form.closest('form').submit();\n      });\n    }\n\n    /**\n     * Compile html form controls.\n     *\n     * @param  {string} action\n     * @param  {float}  amount\n     * @return {void}\n     */\n    compileHtmlControls(action, amount) {\n      const model = this.scheduler.model;\n      const template = wp.template('scheduler-pricing-controls');\n\n      let roomtype = {};\n      if (window._listRoomTypes) {\n        roomtype = _.findWhere(window._listRoomTypes, { id: model.get('calendar') });\n      }\n\n      // Destroy flatpickr first.\n      if (this.flatpickr) {\n        this.flatpickr.destroy();\n      }\n\n      // Compile the html template.\n      const $form = $('#js-scheduler-form-controls').html(template({\n        action:    action,\n        amount:    amount,\n        roomtype:  roomtype,\n        calendar:  model.get('calendar'),\n        endDate:   model.get('endDate').format(DATE_FORMAT),\n        startDate: model.get('startDate').format(DATE_FORMAT),\n      }));\n\n      // Create the flatpickr after.\n      this.flatpickr = flatpickr('#date_start', {\n        dateFormat: 'Y-m-d',\n        plugins: [ new rangePlugin({ input: '#date_end' }) ],\n      });\n\n      return $form;\n    }\n  }\n\n  /**\n   * Document ready!\n   *\n   * @return {void}\n   */\n  $(function() {\n    new PricingScheduler;\n  });\n\n})(jQuery);\n"],"file":"page-pricing.js"}