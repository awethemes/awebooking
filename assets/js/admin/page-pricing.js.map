{"version":3,"names":[],"mappings":"","sources":["admin/page-pricing.js"],"sourcesContent":["(function($, plugin) {\n  'use strict';\n\n  const DATE_FORMAT  = 'YYYY-MM-DD';\n\n  class PricingScheduler {\n    /**\n     * Constructor.\n     *\n     * @return {void}\n     */\n    constructor() {\n      this.flatpickr = null;\n\n      this.scheduler = new ScheduleCalendar({\n        el: '.scheduler',\n        debug: plugin.debug,\n        granularity: 'daily',\n      });\n\n      this.$dialog = plugin.dialog('#scheduler-form-dialog');\n\n      this.scheduler.on('clear', this.handleClearSelected.bind(this));\n      this.scheduler.on('action:set-price', this.handleSetPrice.bind(this));\n      this.scheduler.on('action:reset-price', this.handleResetPrice.bind(this));\n\n      this.initBulkUpdate();\n    }\n\n    /**\n     * Handle on clear selected.\n     *\n     * @return {void}\n     */\n    handleClearSelected() {\n      window.swal && swal.close();\n\n      if (this.flatpickr) {\n        this.flatpickr.destroy();\n      }\n\n      this.$dialog.dialog('close');\n      $('#js-scheduler-form-controls').html('');\n    }\n\n    /**\n     * Handle set price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleSetPrice(e, model) {\n      window.swal && swal.close();\n\n      this.compileHtmlControls('set_price', 0);\n\n      this.$dialog.dialog('open');\n    }\n\n    /**\n     * Handle reset price action.\n     *\n     * @param  {Event}  e\n     * @param  {Object} model\n     * @return {void}\n     */\n    handleResetPrice(e, model) {\n      plugin.confirm(plugin.i18n.warning, () => {\n        const $controls = this.compileHtmlControls('reset_price', 0);\n        $controls.closest('form').submit();\n      });\n    }\n\n    /**\n     * Compile html form controls.\n     *\n     * @param  {string} action\n     * @param  {float}  amount\n     * @return {void}\n     */\n    compileHtmlControls(action, amount) {\n      const model = this.scheduler.model;\n      const template = wp.template('scheduler-pricing-controls');\n\n      let roomtype = {};\n      if (window._listRoomTypes) {\n        roomtype = _.findWhere(window._listRoomTypes, { id: model.get('calendar') });\n      }\n\n      // Destroy flatpickr first.\n      if (this.flatpickr) {\n        this.flatpickr.destroy();\n      }\n\n      // Compile the html template.\n      const $controls = $('#js-scheduler-form-controls').html(template({\n        action:    action,\n        amount:    amount,\n        roomtype:  roomtype,\n        calendar:  model.get('calendar'),\n        endDate:   model.get('endDate').format(DATE_FORMAT),\n        startDate: model.get('startDate').format(DATE_FORMAT),\n      }));\n\n      // Create the flatpickr after.\n      this.flatpickr = flatpickr('#date_start', {\n        dateFormat: 'Y-m-d',\n        plugins: [ new rangePlugin({ input: '#date_end' }) ],\n      });\n\n      return $controls;\n    }\n\n    /**\n     * Handle bulk update action.\n     */\n    initBulkUpdate() {\n      const $dialog = plugin.dialog('#bulk-update-dialog');\n\n      $('.js-open-bulk-update').on('click', function(e) {\n        e.preventDefault();\n        $dialog.dialog('open');\n      });\n\n      flatpickr('#bulk_date_start', {\n        dateFormat: 'Y-m-d',\n        plugins: [ new rangePlugin({ input: '#bulk_date_end' }) ],\n      });\n    }\n  }\n\n  /**\n   * Document ready!\n   *\n   * @return {void}\n   */\n  $(function() {\n    new PricingScheduler;\n  });\n\n})(jQuery, window.awebooking);\n"],"file":"page-pricing.js"}