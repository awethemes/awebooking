{"version":3,"names":[],"mappings":"","sources":["admin/page-pricing.js"],"sourcesContent":["(function($, plugin) {\r\n  'use strict';\r\n\r\n  const DATE_FORMAT  = 'YYYY-MM-DD';\r\n\r\n  class PricingScheduler {\r\n    /**\r\n     * Constructor.\r\n     *\r\n     * @return {void}\r\n     */\r\n    constructor() {\r\n      this.flatpickr = null;\r\n\r\n      this.scheduler = new ScheduleCalendar({\r\n        el: '.scheduler',\r\n        debug: plugin.debug,\r\n        granularity: 'daily',\r\n      });\r\n\r\n      this.$dialog = plugin.dialog('#scheduler-form-dialog');\r\n\r\n      this.scheduler.on('clear', this.handleClearSelected.bind(this));\r\n      this.scheduler.on('action:set-price', this.handleSetPrice.bind(this));\r\n      this.scheduler.on('action:reset-price', this.handleResetPrice.bind(this));\r\n\r\n      this.initBulkUpdate();\r\n    }\r\n\r\n    /**\r\n     * Handle on clear selected.\r\n     *\r\n     * @return {void}\r\n     */\r\n    handleClearSelected() {\r\n      window.swal && swal.close();\r\n\r\n      if (this.flatpickr) {\r\n        this.flatpickr.destroy();\r\n      }\r\n\r\n      this.$dialog.dialog('close');\r\n      $('#js-scheduler-form-controls').html('');\r\n    }\r\n\r\n    /**\r\n     * Handle set price action.\r\n     *\r\n     * @param  {Event}  e\r\n     * @param  {Object} model\r\n     * @return {void}\r\n     */\r\n    handleSetPrice(e, model) {\r\n      window.swal && swal.close();\r\n\r\n      this.compileHtmlControls('set_price', 0);\r\n\r\n      this.$dialog.dialog('open');\r\n    }\r\n\r\n    /**\r\n     * Handle reset price action.\r\n     *\r\n     * @param  {Event}  e\r\n     * @param  {Object} model\r\n     * @return {void}\r\n     */\r\n    handleResetPrice(e, model) {\r\n      plugin.confirm(plugin.i18n.warning, () => {\r\n        const $controls = this.compileHtmlControls('reset_price', 0);\r\n        $controls.closest('form').submit();\r\n      });\r\n    }\r\n\r\n    /**\r\n     * Compile html form controls.\r\n     *\r\n     * @param  {string} action\r\n     * @param  {float}  amount\r\n     * @return {void}\r\n     */\r\n    compileHtmlControls(action, amount) {\r\n      const model = this.scheduler.model;\r\n      const template = wp.template('scheduler-pricing-controls');\r\n\r\n      let roomtype = {};\r\n      if (window._listRoomTypes) {\r\n        roomtype = _.findWhere(window._listRoomTypes, { id: model.get('calendar') });\r\n      }\r\n\r\n      // Destroy flatpickr first.\r\n      if (this.flatpickr) {\r\n        this.flatpickr.destroy();\r\n      }\r\n\r\n      // Compile the html template.\r\n      const $controls = $('#js-scheduler-form-controls').html(template({\r\n        action:    action,\r\n        amount:    amount,\r\n        roomtype:  roomtype,\r\n        calendar:  model.get('calendar'),\r\n        endDate:   model.get('endDate').format(DATE_FORMAT),\r\n        startDate: model.get('startDate').format(DATE_FORMAT),\r\n      }));\r\n\r\n      // Create the flatpickr after.\r\n      this.flatpickr = flatpickr('#date_start', {\r\n        dateFormat: 'Y-m-d',\r\n        plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#date_end' }) ],\r\n      });\r\n\r\n      return $controls;\r\n    }\r\n\r\n    /**\r\n     * Handle bulk update action.\r\n     */\r\n    initBulkUpdate() {\r\n      const $dialog = plugin.dialog('#bulk-update-dialog');\r\n\r\n      $('.js-open-bulk-update').on('click', function(e) {\r\n        e.preventDefault();\r\n        $dialog.dialog('open');\r\n      });\r\n\r\n      flatpickr('#bulk_date_start', {\r\n        mode: 'range',\r\n        dateFormat: 'Y-m-d',\r\n        showMonths: 2,\r\n        plugins: [ new plugin.utils.flatpickrRangePlugin({ input: '#bulk_date_end' }) ],\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Document ready!\r\n   *\r\n   * @return {void}\r\n   */\r\n  $(function() {\r\n    new PricingScheduler();\r\n  });\r\n\r\n})(jQuery, window.awebooking);\r\n"],"file":"page-pricing.js"}