{"version":3,"sources":["admin/schedule-calendar.js"],"names":["$","flatpickr","moment","COLUMN_WIDTH","DATE_FORMAT","Selection","Backbone","Model","extend","defaults","endDate","startDate","calendar","clear","clearSelectedDate","isValid","has","get","getNights","set","trigger","diff","ScheduleCalendar","View","options","debug","marker","popper","granularity","events","initialize","_","model","testColumnWith","$el","find","first","outerWidth","on","handleClickAction","bind","$marker","hide","setupPopper","_tippy","window","Waypoint","setupLabelAnimate","document","onKeyup","listenTo","setMarkerPosition","onClearSelectedDates","data","console","log","format","e","keyCode","preventDefault","$targetLink","currentTarget","text","setSelectionDate","$target","setUnit","getUnitByElement","clickDate","isBefore","clone","drawMarkerOnHover","show","isNull","css","$startDateEl","getElementByDate","position","getCellPossiton","top","left","$endDateEl","index","targetUnit","hoverDate","isSameOrBefore","days","date","element","closest","parseInt","isNaN","childPos","offset","parentPos","tippy","html","theme","arrow","distance","placement","hideOnClick","interactive","performance","animation","duration","popperOptions","modifiers","enabled","preventOverflow","self","$mainContext","onHandler","direction","$mainLabel","$currentLabel","attr","each","context","horizontal","handler","jQuery"],"mappings":"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","sourcesContent":["(function($, flatpickr, moment) {\n  'use strict';\n\n  let COLUMN_WIDTH = 60;\n  const DATE_FORMAT  = 'YYYY-MM-DD';\n\n  const Selection = Backbone.Model.extend({\n    defaults: {\n      endDate: null,\n      startDate: null,\n      calendar: null,\n    },\n\n    clear() {\n      this.clearSelectedDate(null);\n    },\n\n    isValid() {\n      if (! this.has('calendar') || this.get('calendar') < 1) {\n        return false;\n      }\n\n      return this.getNights() >= 0;\n    },\n\n    clearSelectedDate(calendar) {\n      this.set({ startDate: null, endDate: null });\n\n      this.set('calendar', calendar);\n\n      this.trigger('clear_dates');\n    },\n\n    getNights() {\n      if (! this.has('endDate') || ! this.has('startDate')) {\n        return -1;\n      }\n\n      return this.get('endDate').diff(this.get('startDate'), 'days');\n    }\n  });\n\n  const ScheduleCalendar = Backbone.View.extend({\n    options: {\n      debug: false,\n      marker: '.scheduler__marker',\n      popper: '.scheduler__popper > .scheduler__actions',\n      granularity: 'nightly', // 'daily'\n    },\n\n    events: {\n      'click      .scheduler__body .scheduler__date': 'setSelectionDate',\n      'mouseenter .scheduler__body .scheduler__date': 'drawMarkerOnHover',\n    },\n\n    initialize(options) {\n      this.options = _.defaults(options || {}, this.options);\n      this.model = new Selection;\n\n      const testColumnWith = this.$el.find('.scheduler__column').first().outerWidth();\n      if (testColumnWith > COLUMN_WIDTH) {\n        COLUMN_WIDTH = testColumnWith;\n      }\n\n      // Handle click action before setup popper.\n      this.$el.find('.scheduler__actions [data-schedule-action]').on('click', this.handleClickAction.bind(this));\n\n      this.$marker = this.$el.find(this.options.marker);\n      this.$marker.hide();\n\n      this.setupPopper();\n      this.popper = this.$marker[0]._tippy;\n\n      if (window.Waypoint) {\n        this.setupLabelAnimate();\n      }\n\n      $(document).on('keyup', this.onKeyup.bind(this));\n      this.listenTo(this.model, 'change:startDate change:endDate', this.setMarkerPosition);\n      this.listenTo(this.model, 'clear_dates', this.onClearSelectedDates);\n\n      if (this.options.debug) {\n        this.listenTo(this.model, 'change', this.debug);\n      }\n\n      this.$el.data('scheduler', this);\n    },\n\n    debug () {\n      if (this.model.has('startDate') && this.model.has('endDate')) {\n        console.log(this.model.get('calendar'), this.model.get('startDate').format(DATE_FORMAT) + ' - ' + this.model.get('endDate').format(DATE_FORMAT));\n      } else if (this.model.has('startDate')) {\n        console.log(this.model.get('calendar'), this.model.get('startDate').format(DATE_FORMAT) + ' - null');\n      } else if(this.model.has('endDate')) {\n        console.log(this.model.get('calendar'), 'null' + ' - ' + this.model.get('endDate').format(DATE_FORMAT));\n      } else {\n        console.log('null - null');\n      }\n    },\n\n    onKeyup(e) {\n      if (e.keyCode == 27) {\n        this.model.clearSelectedDate();\n      }\n    },\n\n    handleClickAction: function(e) {\n      e.preventDefault();\n      const $targetLink = $(e.currentTarget);\n\n      if (! this.model.isValid()) {\n        return false;\n      }\n\n      if (! $targetLink.data('scheduleAction')) {\n        return false;\n      }\n\n      this.trigger('action:' + $targetLink.data('scheduleAction'), e, this.model );\n    },\n\n    onClearSelectedDates() {\n      this.popper.hide();\n\n      this.$marker.find('span').text(0);\n\n      this.trigger('clear');\n    },\n\n    setSelectionDate(e) {\n      const $target = $(e.currentTarget);\n      const setUnit = this.getUnitByElement($target);\n      const clickDate = moment($target.data('date'));\n\n      if (this.model.has('startDate') && this.model.has('endDate')) {\n        this.model.clearSelectedDate(setUnit);\n        return;\n      }\n\n      if (this.model.has('calendar') && setUnit !== this.model.get('calendar')\n          || this.model.has('startDate') && clickDate.isBefore(this.model.get('startDate'), 'day')) {\n        this.model.clearSelectedDate(setUnit);\n      }\n\n      // Set the start date first.\n      if (!this.model.has('startDate') && !this.model.has('endDate')) {\n        this.model.set('calendar', setUnit);\n        this.model.set('startDate', clickDate.clone());\n\n        this.drawMarkerOnHover(e);\n        return;\n      }\n\n      // Require 1 night for granularity by nightly.\n      if ('nightly' == this.options.granularity && clickDate.diff(this.model.get('startDate'), 'days') < 1 ) {\n        return;\n      }\n\n      this.popper.show();\n      this.model.set('endDate', clickDate.clone());\n      this.trigger('apply', this.model, this);\n    },\n\n    setMarkerPosition() {\n      const endDate = this.model.get('endDate');\n      const startDate = this.model.get('startDate');\n\n      if (_.isNull(startDate) && _.isNull(endDate)) {\n        this.$marker.css('width', COLUMN_WIDTH).hide();\n        return;\n      }\n\n      const $startDateEl = this.getElementByDate(\n        this.model.get('calendar'), startDate\n      );\n\n      if (_.isNull(endDate)) {\n        const position = this.getCellPossiton($startDateEl);\n        this.$marker.show().css({ top: position.top, left: position.left });\n      } else {\n        const $endDateEl = this.getElementByDate(this.model.get('calendar'), endDate);\n        this.$marker.css('width', ($endDateEl.index() - $startDateEl.index() + 1) * COLUMN_WIDTH);\n      }\n    },\n\n    drawMarkerOnHover(e) {\n      const $target = $(e.currentTarget);\n      const targetUnit = this.getUnitByElement($target);\n\n      if (!this.model.has('calendar')\n        || this.model.get('calendar') !== targetUnit\n        || !this.model.has('startDate')\n        || this.model.has('startDate') && this.model.has('endDate')) {\n        return;\n      }\n\n      const hoverDate = moment($target.data('date'));\n      const startDate = this.model.get('startDate');\n\n      if (startDate.isSameOrBefore(hoverDate, 'day')) {\n        const $startDateEl = this.getElementByDate(targetUnit, startDate);\n        const days = ($target.index() - $startDateEl.index() + 1);\n\n        this.$marker.css('width', days * COLUMN_WIDTH);\n        this.$marker.find('span').text('daily' == this.options.granularity ? days : days - 1);\n      }\n    },\n\n    getElementByDate(calendar, date) {\n      if (typeof date === 'object') {\n        date = date.format(DATE_FORMAT);\n      }\n\n      return this.$el\n        .find('[data-calendar=\"' + calendar + '\"]')\n        .find('.scheduler__date[data-date=\"' + date + '\"]');\n    },\n\n    getUnitByElement(element) {\n      let calendar = $(element).data('calendar');\n\n      if (typeof calendar === 'undefined') {\n        calendar = $(element).closest('[data-calendar]').data('calendar');\n      }\n\n      calendar = parseInt(calendar, 10);\n      return ! isNaN(calendar) ? calendar : 0;\n    },\n\n    getCellPossiton(element) {\n      const childPos = element.offset();\n      const parentPos = this.$el.find('.scheduler__body').offset();\n\n      return {\n        top: childPos.top - parentPos.top,\n        left: childPos.left - parentPos.left\n      };\n    },\n\n    /**\n     * Setup the Popper.\n     *\n     * @return {void}\n     */\n    setupPopper() {\n      tippy(this.$marker[0], {\n        html: this.$el.find(this.options.popper)[0],\n        theme: 'abrs',\n        arrow: true,\n        distance: 0,\n        trigger: 'manual',\n        placement: 'bottom',\n        hideOnClick: 'persistent',\n        interactive: true,\n        performance: true,\n        animation: 'shift-away',\n        duration: [150, 150],\n        popperOptions: { modifiers: {\n          hide: { enabled: false },\n          preventOverflow: { enabled: false },\n        }}\n      });\n    },\n\n    /**\n     * Setup the label animate scroll.\n     *\n     * @return {void}\n     */\n    setupLabelAnimate() {\n      const self = this;\n      const $mainContext = self.$el.find('.scheduler__main')[0];\n\n      const onHandler = function(direction) {\n        const $mainLabel    = self.$el.find('.scheduler__aside .scheduler__month-label');\n        const $currentLabel = $(this.element);\n\n        if ('right' === direction) {\n          $currentLabel.attr('data-prev-text', $mainLabel.text());\n          $mainLabel.text($currentLabel.text());\n        } else {\n          $mainLabel.text($currentLabel.data('prevText'));\n          $currentLabel.attr('data-prev-text', '');\n        }\n      };\n\n      self.$el.find('.scheduler__month-label').each(function() {\n        new Waypoint({\n          element: this,\n          context: $mainContext,\n          offset: -50,\n          horizontal: true,\n          handler: onHandler,\n        });\n      });\n    }\n  });\n\n  window.ScheduleCalendar = ScheduleCalendar;\n\n})(jQuery, window.flatpickr, window.moment);\n"],"file":"schedule-calendar.js"}